<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Text Summarizer</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#4f46e5',
                        'secondary': '#8b5cf6',
                        'background': '#f9fafb',
                        'surface': '#ffffff',
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>

    <style>
        textarea::-webkit-scrollbar {
            width: 8px;
        }

        textarea::-webkit-scrollbar-thumb {
            background-color: #a78bfa;
            border-radius: 4px;
        }

        textarea::-webkit-scrollbar-track {
            background-color: #f3f4f6;
        }

        .loading-btn {
            pointer-events: none;
            opacity: 0.7;
            cursor: not-allowed;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-background font-sans min-h-screen p-4 sm:p-8">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-2">
                <span class="text-primary">AI</span> Text Summarizer
            </h1>
            <p class="text-lg text-gray-600">Summarize articles, PDFs, DOCX files & more using Pegasus.</p>
        </header>

        <main class="bg-surface shadow-2xl rounded-xl p-6 sm:p-10 border border-gray-100">

            <!-- Input Section -->
            <section class="mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">1. Provide Text or Document</h2>

                <!-- Text input -->
                <label class="block text-sm font-medium text-gray-700 mb-1">Paste your text:</label>
                <textarea id="text-input" rows="10"
                    class="w-full p-4 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition resize-none"
                    placeholder="Paste article, essay, or text here"></textarea>

                <div class="text-center text-sm text-gray-500 my-4">
                    <span class="bg-gray-100 px-3 py-1 rounded-full border">OR</span>
                </div>

                <!-- File Upload -->
                <div
                    class="flex flex-col items-center justify-center border-2 border-dashed border-primary/50 rounded-lg p-6 bg-primary/5 hover:bg-primary/10 transition">

                    <input type="file" id="doc-input" accept=".txt,.md,.csv,.log,.pdf,.docx" class="hidden"
                        onchange="handleFileSelection(this.files)">

                    <button onclick="document.getElementById('doc-input').click()" type="button"
                        class="flex items-center space-x-2 text-primary font-medium hover:text-secondary transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                        </svg>
                        <span>Upload Document (.pdf, .docx, .txt, etc.)</span>
                    </button>

                    <p id="file-status" class="mt-2 text-sm text-gray-500"></p>
                </div>
            </section>

            <!-- Summarize Button -->
            <div class="flex justify-center mb-10">
                <button id="summarize-btn" onclick="handleSummarizeClick()"
                    class="px-8 py-3 text-lg font-bold text-white bg-primary rounded-full shadow-lg hover:bg-secondary transition">
                    Summarize
                </button>
            </div>

            <!-- Output Section -->
            <section>
                <h2 class="text-2xl font-semibold text-gray-800 mb-4 flex items-center">
                    2. Summary Result
                    <span id="word-count" class="ml-4 text-sm font-normal text-gray-500 hidden"></span>
                </h2>

                <div id="summary-output"
                    class="min-h-[180px] p-4 bg-gray-50 border border-gray-200 rounded-lg text-gray-700 whitespace-pre-wrap">
                    <p class="text-gray-400 italic">Your summary will appear here.</p>
                </div>

                <div id="message-box" class="hidden mt-4 p-3 rounded-lg text-sm"></div>
            </section>

        </main>
    </div>

    <!-- ✅ Updated Script (Pegasus backend integrated) -->
    <script>
        const textInput = document.getElementById('text-input');
        const fileInput = document.getElementById('doc-input');
        const fileStatus = document.getElementById('file-status');
        const summaryOutput = document.getElementById('summary-output');
        const summarizeBtn = document.getElementById('summarize-btn');
        const messageBox = document.getElementById('message-box');
        const wordCountDisplay = document.getElementById('word-count');

        let uploadedFile = null;

        /* ✅ Utility message box */
        function displayMessage(msg, type) {
            messageBox.textContent = msg;
            messageBox.classList.remove('hidden', 'bg-red-100', 'bg-green-100', 'text-red-800', 'text-green-800');

            if (type === "error") messageBox.classList.add('bg-red-100', 'text-red-800');
            if (type === "success") messageBox.classList.add('bg-green-100', 'text-green-800');

            setTimeout(() => messageBox.classList.add('hidden'), 5000);
        }

        function setLoading(state) {
            if (state) {
                summarizeBtn.classList.add("loading-btn");
                summarizeBtn.innerHTML = `<div class="spinner mr-2"></div> Summarizing...`;
            } else {
                summarizeBtn.classList.remove("loading-btn");
                summarizeBtn.innerHTML = "Summarize";
            }
        }

        /* ✅ File chosen */
        function handleFileSelection(files) {
            if (!files.length) return;
            uploadedFile = files[0];
            fileStatus.textContent = `Selected: ${uploadedFile.name}`;

            // Clear text input because file will be used instead
            textInput.value = "";
        }

        /* ✅ Text summarization (POST /summarize) */
        async function summarizeText(text) {
            const response = await fetch("/summarize", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ text })
            });
            const data = await response.json();
            if (!response.ok) throw new Error(data.error);
            return data.summary;
        }

        /* ✅ File summarization (POST /summarize-file) */
        async function summarizeFile(file) {
            const formData = new FormData();
            formData.append("file", file);

            const response = await fetch("/summarize-file", {
                method: "POST",
                body: formData
            });

            const data = await response.json();
            if (!response.ok) throw new Error(data.error);
            return data.summary;
        }

        /* ✅ Main controller */
        async function handleSummarizeClick() {
            setLoading(true);
            summaryOutput.innerHTML = `<p class="text-gray-400 italic">Working...</p>`;
            wordCountDisplay.classList.add("hidden");

            try {
                let summary = "";
                let text = textInput.value.trim();

                if (uploadedFile) {
                    summary = await summarizeFile(uploadedFile);
                } else if (text.length > 0) {
                    summary = await summarizeText(text);
                } else {
                    throw new Error("Please paste text or upload a file.");
                }

                summaryOutput.textContent = summary;

                const wc = summary.split(/\s+/).filter(Boolean).length;
                wordCountDisplay.textContent = `(~${wc} words)`;
                wordCountDisplay.classList.remove("hidden");

            } catch (err) {
                displayMessage(err.message, "error");
                summaryOutput.innerHTML = `<p class="text-red-500">${err.message}</p>`;
            }

            setLoading(false);
        }

        /* Clear file when typing */
        textInput.addEventListener("input", () => {
            if (textInput.value.trim().length > 0) {
                uploadedFile = null;
                fileInput.value = "";
                fileStatus.textContent = "";
            }
        });
    </script>

</body>

</html>
